<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Forex Decision Engine</title>
  <link rel="stylesheet" href="/css/styles.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéØ</text></svg>">
</head>
<body>
  <a href="#main-content" class="skip-link">Skip to main content</a>
  
  <!-- Upgrade Notifications Container -->
  <div id="upgrade-notifications" role="alert" aria-live="polite"></div>
  
  <div id="app">
    <!-- Header -->
    <header class="header" role="banner">
      <div class="header-brand">
        <span class="header-icon" aria-hidden="true">üéØ</span>
        <h1>Forex Decision Engine</h1>
      </div>
      <nav class="header-nav" role="navigation" aria-label="Main navigation">
        <button class="nav-btn active" data-screen="dashboard" aria-current="page" aria-label="Dashboard">Dashboard</button>
        <button class="nav-btn" data-screen="auto-scan" aria-label="Auto-scan">Auto <span class="nav-badge hidden" id="detections-badge">0</span></button>
        <button class="nav-btn" data-screen="journal" aria-label="View trade journal">Journal</button>
        <button class="nav-btn" data-screen="settings" aria-label="Configure settings">Settings</button>
      </nav>
    </header>
    
    <!-- Status Ticker Bar -->
    <div class="status-ticker" role="status" aria-label="System status">
      <div class="ticker-item">
        <span class="ticker-dot" id="connection-status"></span>
        <span class="ticker-label">API</span>
        <span class="ticker-value" id="api-status">Connected</span>
      </div>
      <div class="ticker-item">
        <span class="ticker-label">Account</span>
        <span class="ticker-value" id="ticker-account">$10,000</span>
      </div>
      <div class="ticker-item">
        <span class="ticker-label">Risk</span>
        <span class="ticker-value" id="ticker-risk">0.5%</span>
      </div>
      <div class="ticker-item">
        <span class="ticker-label">Open P&L</span>
        <span class="ticker-value positive" id="ticker-pnl">$0.00</span>
      </div>
      <div class="ticker-item">
        <span class="ticker-label">Win Rate</span>
        <span class="ticker-value" id="ticker-winrate">--</span>
      </div>
      <div class="ticker-item">
        <span class="ticker-label">Signals</span>
        <span class="ticker-value" id="ticker-signals">0</span>
      </div>
      <div class="ticker-item">
        <span class="ticker-label">Auto-Scan</span>
        <span class="ticker-value" id="ticker-autoscan">OFF</span>
      </div>
    </div>

    <!-- Main Content -->
    <main class="main" id="main-content" role="main">
      <!-- Welcome Screen (shown on first visit) -->
      <section id="welcome-screen" class="screen welcome-screen hidden">
        <div class="welcome-content">
          <div class="welcome-icon">üéØ</div>
          <h2>Welcome to Forex Decision Engine</h2>
          <p class="welcome-subtitle">Clear trade signals. No chart overload.</p>
          
          <div class="welcome-features">
            <div class="feature">
              <span class="feature-icon">üìç</span>
              <span>Exact entry zones</span>
            </div>
            <div class="feature">
              <span class="feature-icon">üõ°Ô∏è</span>
              <span>Stop loss levels</span>
            </div>
            <div class="feature">
              <span class="feature-icon">üéØ</span>
              <span>Take profit targets (2R+)</span>
            </div>
            <div class="feature">
              <span class="feature-icon">üìä</span>
              <span>Position sizing</span>
            </div>
          </div>
          
          <div class="welcome-warning">
            <p>‚ö†Ô∏è <strong>Risk Disclaimer:</strong> This tool is for educational purposes only. 
            Trading forex and crypto involves significant risk. Past signals do not guarantee future results. 
            Always use proper risk management and never trade with money you can't afford to lose.</p>
          </div>
          
          <button class="btn btn-primary btn-large" id="get-started-btn">
            Get Started ‚Üí
          </button>
        </div>
      </section>

      <!-- Settings Screen -->
      <section id="settings-screen" class="screen hidden">
        <div class="screen-header">
          <h2>‚öôÔ∏è Settings</h2>
        </div>
        
        <form id="settings-form" class="settings-form">
          <div class="form-group">
            <label for="account-size">Account Size (USD)</label>
            <input type="number" id="account-size" min="100" max="1000000" step="100" value="10000">
            <span class="form-hint">Min: $100 | Max: $1,000,000</span>
          </div>
          
          <div class="form-group">
            <label for="risk-percent">Risk per Trade</label>
            <select id="risk-percent">
              <option value="0.25">0.25% (Conservative)</option>
              <option value="0.5" selected>0.5% (Recommended)</option>
              <option value="1">1% (Standard)</option>
              <option value="2">2% (Aggressive)</option>
            </select>
            <span class="form-hint" id="risk-amount-hint">Risk: $50 per trade</span>
          </div>
          
          <div class="form-group">
            <label>Trading Style</label>
            <div class="radio-group">
              <label class="radio-option">
                <input type="radio" name="style" value="intraday" checked>
                <span class="radio-label">
                  <strong>Intraday</strong>
                  <small>H4 trend ‚Üí H1 entry | Refresh: 5 min</small>
                </span>
              </label>
              <label class="radio-option">
                <input type="radio" name="style" value="swing">
                <span class="radio-label">
                  <strong>Swing</strong>
                  <small>D1 trend ‚Üí H4 entry | Refresh: 15 min</small>
                </span>
              </label>
            </div>
          </div>
          
          <div class="form-group">
            <label for="timezone">Timezone</label>
            <select id="timezone">
              <option value="America/New_York">Eastern Time (ET)</option>
              <option value="America/Chicago" selected>Central Time (CT)</option>
              <option value="America/Denver">Mountain Time (MT)</option>
              <option value="America/Los_Angeles">Pacific Time (PT)</option>
              <option value="Europe/London">London (GMT/BST)</option>
              <option value="UTC">UTC</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>Trading Mode</label>
            <div class="radio-group">
              <label class="radio-option">
                <input type="radio" name="trading-mode" value="paper" checked>
                <span class="radio-label">
                  <strong>Paper Trading</strong>
                  <small>Practice mode - no drawdown limits enforced</small>
                </span>
              </label>
              <label class="radio-option live-mode-option">
                <input type="radio" name="trading-mode" value="live">
                <span class="radio-label">
                  <strong>Live Trading</strong>
                  <small>E8 Markets rules: 4% daily / 6% total drawdown limits</small>
                </span>
              </label>
            </div>
            <span class="form-hint" id="trading-mode-hint">Paper mode skips drawdown checks during development</span>
          </div>
          
          <button type="submit" class="btn btn-primary">Save Settings</button>
        </form>
        
        <div class="settings-info">
          <p>‚ÑπÔ∏è Settings are saved locally in your browser.</p>
        </div>
      </section>

      <!-- Dashboard Screen (Bloomberg-style grid layout) -->
      <section id="dashboard-screen" class="screen">
        <div class="dashboard-grid">
          <!-- Left Sidebar: Watchlist & Scan -->
          <div class="panel sidebar-panel">
            <div class="panel-header">
              <h3>Instruments</h3>
              <select id="strategy-select" class="strategy-dropdown-compact">
                <option value="ema-pullback-intra">EMA Pullback</option>
              </select>
            </div>
            <div class="panel-content">
              <div class="watchlist-sections" id="watchlist-sections">
                <div class="watchlist-section">
                  <div class="watchlist-section-header" data-section="forex">
                    <h4>Forex</h4><span class="count">28</span>
                  </div>
                  <div class="watchlist-items" id="forex-watchlist"></div>
                </div>
                <div class="watchlist-section">
                  <div class="watchlist-section-header" data-section="metals">
                    <h4>Metals</h4><span class="count">2</span>
                  </div>
                  <div class="watchlist-items" id="metals-watchlist"></div>
                </div>
                <div class="watchlist-section">
                  <div class="watchlist-section-header" data-section="indices">
                    <h4>Indices</h4><span class="count">6</span>
                  </div>
                  <div class="watchlist-items" id="indices-watchlist"></div>
                </div>
                <div class="watchlist-section">
                  <div class="watchlist-section-header" data-section="commodities">
                    <h4>Commodities</h4><span class="count">2</span>
                  </div>
                  <div class="watchlist-items" id="commodities-watchlist"></div>
                </div>
                <div class="watchlist-section">
                  <div class="watchlist-section-header" data-section="crypto">
                    <h4>Crypto</h4><span class="count">8</span>
                  </div>
                  <div class="watchlist-items" id="crypto-watchlist"></div>
                </div>
              </div>
            </div>
            <div class="scan-footer">
              <span id="selected-count">0</span> selected
              <button class="btn btn-primary btn-small" id="scan-btn" disabled>Scan</button>
            </div>
          </div>
          
          <!-- Main Panel: Signals Table -->
          <div class="panel main-panel">
            <div class="panel-header">
              <h3>Signals</h3>
              <div class="panel-actions">
                <button class="filter-btn active" data-filter="all">All</button>
                <button class="filter-btn" data-filter="trades">Trades</button>
                <button class="filter-btn" data-filter="a+">A+</button>
                <span class="scan-time" id="last-scan-time"></span>
              </div>
            </div>
            <div class="panel-content">
              <table class="data-table" id="signals-table">
                <thead>
                  <tr>
                    <th class="sortable" data-sort="symbol">Symbol</th>
                    <th class="sortable" data-sort="direction">Dir</th>
                    <th class="sortable" data-sort="grade">Grade</th>
                    <th class="col-price">Entry</th>
                    <th class="col-price">SL</th>
                    <th class="col-price">TP1</th>
                    <th class="col-price">TP2</th>
                    <th class="col-numeric">Lots</th>
                    <th class="col-numeric">R:R</th>
                    <th>Strategy</th>
                    <th class="col-actions">Actions</th>
                  </tr>
                </thead>
                <tbody id="signals-tbody">
                  <tr><td colspan="11" class="empty-cell">Select instruments and scan for signals</td></tr>
                </tbody>
              </table>
            </div>
          </div>
          
          <!-- Right Sidebar: Metrics -->
          <div class="panel metrics-panel">
            <div class="panel-header">
              <h3>Portfolio</h3>
            </div>
            <div class="panel-content">
              <div class="metric-card">
                <div class="metric-label">Account Balance</div>
                <div class="metric-value" id="metric-balance">$10,000</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">Open P&L</div>
                <div class="metric-value positive" id="metric-open-pnl">$0.00</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">Daily P&L</div>
                <div class="metric-value" id="metric-daily-pnl">$0.00</div>
                <div class="metric-subtext">Limit: -$400 (4%)</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">Max Drawdown</div>
                <div class="metric-value" id="metric-drawdown">0.00%</div>
                <div class="metric-subtext">Limit: 6%</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">Win Rate</div>
                <div class="metric-value" id="metric-winrate">--</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">Avg R-Multiple</div>
                <div class="metric-value" id="metric-avgr">--</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">Open Positions</div>
                <div class="metric-value" id="metric-positions">0</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">Active Signals</div>
                <div class="metric-value" id="metric-signals">0</div>
              </div>
            </div>
          </div>
          
          <!-- Bottom Panel: Running Trades (mini journal) -->
          <div class="panel journal-panel">
            <div class="panel-header">
              <h3>Running Trades</h3>
              <button class="table-btn" onclick="UI.switchScreen('journal')">View All</button>
            </div>
            <div class="panel-content">
              <table class="data-table" id="running-trades-table">
                <thead>
                  <tr>
                    <th>Symbol</th>
                    <th>Dir</th>
                    <th class="col-price">Entry</th>
                    <th class="col-price">Current</th>
                    <th class="col-pnl">P&L</th>
                    <th class="col-numeric">Lots</th>
                    <th>Status</th>
                    <th class="col-actions">Actions</th>
                  </tr>
                </thead>
                <tbody id="running-trades-tbody">
                  <tr><td colspan="8" class="empty-cell">No running trades</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <!-- Auto-Scan Screen (Combined Config + Detections) -->
      <section id="auto-scan-screen" class="screen hidden">
        <div class="screen-header">
          <h2>Auto-Scan</h2>
          <div class="screen-header-actions">
            <label class="toggle-switch">
              <input type="checkbox" id="autoscan-toggle">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>
        
        <div class="auto-scan-layout">
          <!-- Left Panel: Configuration -->
          <div class="autoscan-config-panel">
            <div class="panel-header">
              <h3>Configuration</h3>
              <span class="status-indicator" id="autoscan-running">Stopped</span>
            </div>
            
            <div class="config-form">
              <div class="config-row">
                <label>Alert Email</label>
                <input type="email" id="autoscan-email" placeholder="your@email.com" class="config-input">
              </div>
              <div class="config-row">
                <label>Watchlist</label>
                <select id="autoscan-preset" class="config-select">
                  <option value="majors-gold" selected>Majors + Gold (8)</option>
                  <option value="majors">Major Pairs (7)</option>
                  <option value="crypto">Crypto 24/7 (8)</option>
                  <option value="metals">Metals (2)</option>
                  <option value="indices">Indices (6)</option>
                  <option value="commodities">Commodities (2)</option>
                  <option value="minors">Minor Pairs (21)</option>
                  <option value="all">All 46 Instruments</option>
                </select>
              </div>
              <div class="config-row">
                <label>Min Grade</label>
                <select id="autoscan-grade" class="config-select">
                  <option value="A+">A+ Only</option>
                  <option value="A">A or better</option>
                  <option value="B+" selected>B+ or better</option>
                  <option value="B">B or better</option>
                </select>
              </div>
              <div class="config-row">
                <label>Interval</label>
                <select id="autoscan-interval" class="config-select">
                  <option value="180000">3 minutes</option>
                  <option value="300000" selected>5 minutes</option>
                  <option value="600000">10 minutes</option>
                  <option value="900000">15 minutes</option>
                  <option value="1800000">30 minutes</option>
                </select>
              </div>
              <div class="config-row">
                <label class="checkbox-label">
                  <input type="checkbox" id="autoscan-market-hours" checked>
                  <span>Skip closed markets</span>
                </label>
              </div>
            </div>
            
            <div class="autoscan-status-panel">
              <div class="status-grid">
                <div class="status-item">
                  <span class="status-label">Markets</span>
                  <div class="market-indicators">
                    <span class="market-indicator forex" id="market-forex" title="Forex Market">FX</span>
                    <span class="market-indicator crypto active" id="market-crypto" title="Crypto 24/7">Crypto</span>
                  </div>
                </div>
                <div class="status-item">
                  <span class="status-label">Last Scan</span>
                  <span class="status-value" id="autoscan-last">Never</span>
                </div>
                <div class="status-item">
                  <span class="status-label">Next Scan</span>
                  <span class="status-value" id="autoscan-next">-</span>
                </div>
                <div class="status-item">
                  <span class="status-label">Scanned</span>
                  <span class="status-value" id="autoscan-scanned">0</span>
                </div>
              </div>
              <div class="scan-progress hidden" id="scan-progress">
                <div class="progress-bar">
                  <div class="progress-fill" id="scan-progress-fill"></div>
                </div>
                <span class="progress-text" id="scan-progress-text"></span>
              </div>
            </div>
          </div>
          
          <!-- Right Panel: Detected Trades -->
          <div class="detections-panel">
            <div class="panel-header">
              <h3>Detected Trades</h3>
              <button class="btn btn-small" id="refresh-detections-btn">Refresh</button>
            </div>
            
            <div class="detections-summary">
              <div class="stat-card cooling">
                <span class="stat-value" id="stat-cooling">0</span>
                <span class="stat-label">Cooling</span>
              </div>
              <div class="stat-card eligible">
                <span class="stat-value" id="stat-eligible">0</span>
                <span class="stat-label">Ready</span>
              </div>
              <div class="stat-card total">
                <span class="stat-value" id="stat-total-detections">0</span>
                <span class="stat-label">Total</span>
              </div>
            </div>
            
            <div class="detections-filters">
              <button class="filter-btn active" data-detection-filter="all">All</button>
              <button class="filter-btn" data-detection-filter="cooling_down">Cooling</button>
              <button class="filter-btn" data-detection-filter="eligible">Ready</button>
            </div>
            
            <div class="detections-container" id="detections-container">
              <div class="empty-state">
                <p>No detected trades yet</p>
                <p class="empty-hint">Enable auto-scan to detect opportunities</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Legacy Results Screen (keep for backward compat, hidden) -->
      <section id="results-screen" class="screen hidden">
        <div class="results-footer hidden" id="results-footer-legacy">
          <button class="btn btn-secondary" id="export-btn">üíæ Export JSON</button>
          <button class="btn btn-secondary" id="copy-summary-btn">üìã Copy Summary</button>
        </div>
      </section>

      <!-- Loading Overlay -->
      <div id="loading-overlay" class="loading-overlay hidden">
        <div class="loading-content">
          <div class="spinner"></div>
          <p class="loading-text" id="loading-text">Scanning...</p>
          <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
          </div>
          <p class="progress-text" id="progress-text">0/0 complete</p>
        </div>
      </div>
    </main>

    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container" role="status" aria-live="polite" aria-label="Notifications"></div>

    <!-- Trade Modal -->
    <div id="trade-modal" class="modal hidden">
      <div class="modal-backdrop" onclick="App.closeTradeModal()"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="trade-modal-title">Log Trade</h3>
          <button class="modal-close" onclick="App.closeTradeModal()">&times;</button>
        </div>
        <div class="modal-body">
          <form id="trade-form">
            <input type="hidden" id="trade-symbol">
            <input type="hidden" id="trade-action">
            <input type="hidden" id="trade-signal-id">
            
            <div class="form-row">
              <div class="form-group">
                <label for="trade-entry-price">Entry Price</label>
                <input type="number" id="trade-entry-price" step="any" required>
              </div>
              <div class="form-group">
                <label for="trade-lots">Lots</label>
                <input type="number" id="trade-lots" step="0.01" min="0.01" required>
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="trade-stop-loss">Stop Loss</label>
                <input type="number" id="trade-stop-loss" step="any" required>
              </div>
              <div class="form-group">
                <label for="trade-take-profit">Take Profit</label>
                <input type="number" id="trade-take-profit" step="any" required>
              </div>
            </div>
            
            <div class="form-group">
              <label>Status</label>
              <div class="radio-group-inline">
                <label class="radio-inline">
                  <input type="radio" name="trade-status" value="pending"> Pending
                </label>
                <label class="radio-inline">
                  <input type="radio" name="trade-status" value="running" checked> Running
                </label>
                <label class="radio-inline">
                  <input type="radio" name="trade-status" value="closed"> Closed
                </label>
              </div>
            </div>
            
            <div id="trade-closed-fields" class="hidden">
              <div class="form-row">
                <div class="form-group">
                  <label for="trade-exit-price">Exit Price</label>
                  <input type="number" id="trade-exit-price" step="any">
                </div>
                <div class="form-group">
                  <label>Result</label>
                  <div class="radio-group-inline">
                    <label class="radio-inline">
                      <input type="radio" name="trade-result" value="win"> Win
                    </label>
                    <label class="radio-inline">
                      <input type="radio" name="trade-result" value="loss"> Loss
                    </label>
                    <label class="radio-inline">
                      <input type="radio" name="trade-result" value="breakeven"> BE
                    </label>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="form-group">
              <label for="trade-notes">Notes (optional)</label>
              <textarea id="trade-notes" rows="2" placeholder="Any observations..."></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" onclick="App.closeTradeModal()">Cancel</button>
          <button class="btn btn-primary" onclick="App.saveTradeEntry()">Save Trade</button>
        </div>
      </div>
    </div>

    <!-- Journal Screen (add to nav later) -->
    <section id="journal-screen" class="screen hidden">
      <div class="journal-layout">
        <!-- Stats Header -->
        <div class="journal-header">
          <div class="metrics-row">
            <div class="metric-card">
              <div class="metric-label">Trades</div>
              <div class="metric-value" id="stat-taken">0</div>
            </div>
            <div class="metric-card">
              <div class="metric-label">Win Rate</div>
              <div class="metric-value" id="stat-winrate">--</div>
            </div>
            <div class="metric-card">
              <div class="metric-label">Avg R</div>
              <div class="metric-value" id="stat-avgr">--</div>
            </div>
            <div class="metric-card">
              <div class="metric-label">Total P&L</div>
              <div class="metric-value" id="stat-pnl">$0</div>
            </div>
          </div>
          <div class="journal-actions">
            <button class="filter-btn active" data-journal-filter="all">All</button>
            <button class="filter-btn" data-journal-filter="pending">Pending</button>
            <button class="filter-btn" data-journal-filter="running">Running</button>
            <button class="filter-btn" data-journal-filter="closed">Closed</button>
            <button class="btn btn-small btn-primary" onclick="App.openManualTradeModal()">+ Trade</button>
            <a href="/api/journal/export" class="table-btn" download>Export</a>
          </div>
        </div>
        
        <!-- Journal Table -->
        <div class="journal-table-container">
          <table class="data-table" id="journal-table">
            <thead>
              <tr>
                <th class="sortable" data-sort="date">Date</th>
                <th class="sortable" data-sort="symbol">Symbol</th>
                <th>Dir</th>
                <th>Grade</th>
                <th class="col-price">Entry</th>
                <th class="col-price">SL</th>
                <th class="col-price">TP</th>
                <th class="col-price">Exit</th>
                <th class="col-numeric">Lots</th>
                <th class="col-pnl">P&L</th>
                <th class="col-numeric">R</th>
                <th>Status</th>
                <th class="col-actions">Actions</th>
              </tr>
            </thead>
            <tbody id="journal-tbody">
              <tr><td colspan="13" class="empty-cell">No trades logged yet</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>
  </div>

  <script src="/js/api.js?v=20260109a"></script>
  <script src="/js/storage.js?v=20260109a"></script>
  <script src="/js/ui.js?v=20260109a"></script>
  <script src="/js/app.js?v=20260109a"></script>
</body>
</html>
