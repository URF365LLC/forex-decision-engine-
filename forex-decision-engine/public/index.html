<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Forex Decision Engine</title>
  <link rel="stylesheet" href="/css/styles.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéØ</text></svg>">
</head>
<body>
  <a href="#main-content" class="skip-link">Skip to main content</a>
  
  <!-- Upgrade Notifications Container -->
  <div id="upgrade-notifications" role="alert" aria-live="polite"></div>
  
  <div id="app">
    <!-- Header -->
    <header class="header" role="banner">
      <div class="header-brand">
        <span class="header-icon" aria-hidden="true">üéØ</span>
        <h1>Forex Decision Engine</h1>
      </div>
      <nav class="header-nav" role="navigation" aria-label="Main navigation">
        <button class="nav-btn active" data-screen="results" aria-current="page" aria-label="View trading results">Results</button>
        <button class="nav-btn" data-screen="detections" aria-label="View detected trades">Detections <span class="nav-badge hidden" id="detections-badge">0</span></button>
        <button class="nav-btn" data-screen="watchlist" aria-label="Manage watchlist">Watchlist</button>
        <button class="nav-btn" data-screen="journal" aria-label="View trade journal">Journal</button>
        <button class="nav-btn" data-screen="settings" aria-label="Configure settings">Settings</button>
      </nav>
    </header>

    <!-- Main Content -->
    <main class="main" id="main-content" role="main">
      <!-- Welcome Screen (shown on first visit) -->
      <section id="welcome-screen" class="screen welcome-screen hidden">
        <div class="welcome-content">
          <div class="welcome-icon">üéØ</div>
          <h2>Welcome to Forex Decision Engine</h2>
          <p class="welcome-subtitle">Clear trade signals. No chart overload.</p>
          
          <div class="welcome-features">
            <div class="feature">
              <span class="feature-icon">üìç</span>
              <span>Exact entry zones</span>
            </div>
            <div class="feature">
              <span class="feature-icon">üõ°Ô∏è</span>
              <span>Stop loss levels</span>
            </div>
            <div class="feature">
              <span class="feature-icon">üéØ</span>
              <span>Take profit targets (2R+)</span>
            </div>
            <div class="feature">
              <span class="feature-icon">üìä</span>
              <span>Position sizing</span>
            </div>
          </div>
          
          <div class="welcome-warning">
            <p>‚ö†Ô∏è <strong>Risk Disclaimer:</strong> This tool is for educational purposes only. 
            Trading forex and crypto involves significant risk. Past signals do not guarantee future results. 
            Always use proper risk management and never trade with money you can't afford to lose.</p>
          </div>
          
          <button class="btn btn-primary btn-large" id="get-started-btn">
            Get Started ‚Üí
          </button>
        </div>
      </section>

      <!-- Settings Screen -->
      <section id="settings-screen" class="screen hidden">
        <div class="screen-header">
          <h2>‚öôÔ∏è Settings</h2>
        </div>
        
        <form id="settings-form" class="settings-form">
          <div class="form-group">
            <label for="account-size">Account Size (USD)</label>
            <input type="number" id="account-size" min="100" max="1000000" step="100" value="10000">
            <span class="form-hint">Min: $100 | Max: $1,000,000</span>
          </div>
          
          <div class="form-group">
            <label for="risk-percent">Risk per Trade</label>
            <select id="risk-percent">
              <option value="0.25">0.25% (Conservative)</option>
              <option value="0.5" selected>0.5% (Recommended)</option>
              <option value="1">1% (Standard)</option>
              <option value="2">2% (Aggressive)</option>
            </select>
            <span class="form-hint" id="risk-amount-hint">Risk: $50 per trade</span>
          </div>
          
          <div class="form-group">
            <label>Trading Style</label>
            <div class="radio-group">
              <label class="radio-option">
                <input type="radio" name="style" value="intraday" checked>
                <span class="radio-label">
                  <strong>Intraday</strong>
                  <small>H4 trend ‚Üí H1 entry | Refresh: 5 min</small>
                </span>
              </label>
              <label class="radio-option">
                <input type="radio" name="style" value="swing">
                <span class="radio-label">
                  <strong>Swing</strong>
                  <small>D1 trend ‚Üí H4 entry | Refresh: 15 min</small>
                </span>
              </label>
            </div>
          </div>
          
          <div class="form-group">
            <label for="timezone">Timezone</label>
            <select id="timezone">
              <option value="America/New_York">Eastern Time (ET)</option>
              <option value="America/Chicago" selected>Central Time (CT)</option>
              <option value="America/Denver">Mountain Time (MT)</option>
              <option value="America/Los_Angeles">Pacific Time (PT)</option>
              <option value="Europe/London">London (GMT/BST)</option>
              <option value="UTC">UTC</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>Trading Mode</label>
            <div class="radio-group">
              <label class="radio-option">
                <input type="radio" name="trading-mode" value="paper" checked>
                <span class="radio-label">
                  <strong>Paper Trading</strong>
                  <small>Practice mode - no drawdown limits enforced</small>
                </span>
              </label>
              <label class="radio-option live-mode-option">
                <input type="radio" name="trading-mode" value="live">
                <span class="radio-label">
                  <strong>Live Trading</strong>
                  <small>E8 Markets rules: 4% daily / 6% total drawdown limits</small>
                </span>
              </label>
            </div>
            <span class="form-hint" id="trading-mode-hint">Paper mode skips drawdown checks during development</span>
          </div>
          
          <button type="submit" class="btn btn-primary">Save Settings</button>
        </form>
        
        <div class="settings-info">
          <p>‚ÑπÔ∏è Settings are saved locally in your browser.</p>
        </div>
      </section>

      <!-- Watchlist Screen -->
      <section id="watchlist-screen" class="screen hidden">
        <div class="screen-header">
          <h2>üìã Watchlist</h2>
          <div class="search-box">
            <input type="text" id="symbol-search" placeholder="Search symbols...">
          </div>
        </div>
        
        <!-- Strategy Selection -->
        <div class="form-group" style="margin: 0 1rem 1rem 1rem;">
          <label for="strategy-select" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
            Strategy
          </label>
          <select id="strategy-select" class="form-control" 
            style="width: 100%; padding: 0.75rem; background: var(--bg-secondary); 
                   border: 1px solid var(--border); border-radius: 8px; 
                   color: var(--text-primary); font-size: 0.95rem;">
            <option value="ema-pullback-intra">EMA Pullback (50% WR)</option>
          </select>
        </div>
        
        <div class="watchlist-container">
          <div class="symbol-section">
            <div class="section-header">
              <h3>Forex (28 pairs)</h3>
              <button class="btn btn-small" data-select="forex">Select All</button>
            </div>
            <div class="symbol-grid" id="forex-symbols"></div>
          </div>
          
          <div class="symbol-section">
            <div class="section-header">
              <h3>Metals (2 pairs)</h3>
              <button class="btn btn-small" data-select="metals">Select All</button>
            </div>
            <div class="symbol-grid" id="metals-symbols"></div>
          </div>
          
          <div class="symbol-section">
            <div class="section-header">
              <h3>Indices (6)</h3>
              <button class="btn btn-small" data-select="indices">Select All</button>
            </div>
            <div class="symbol-grid" id="indices-symbols"></div>
          </div>
          
          <div class="symbol-section">
            <div class="section-header">
              <h3>Commodities (2)</h3>
              <button class="btn btn-small" data-select="commodities">Select All</button>
            </div>
            <div class="symbol-grid" id="commodities-symbols"></div>
          </div>
          
          <div class="symbol-section">
            <div class="section-header">
              <h3>Crypto (8 pairs)</h3>
              <button class="btn btn-small" data-select="crypto">Select All</button>
            </div>
            <div class="symbol-grid" id="crypto-symbols"></div>
          </div>
        </div>
        
        <div class="watchlist-footer manual-scan-footer">
          <div class="selection-info">
            <span id="selected-count">0</span> symbols selected
            <span class="scan-estimate" id="scan-estimate"></span>
          </div>
          <div class="watchlist-actions">
            <button class="btn btn-secondary" id="clear-selection-btn">Clear All</button>
            <button class="btn btn-primary" id="scan-btn" disabled>Scan Selected</button>
          </div>
        </div>
        
        <div class="autoscan-panel" id="autoscan-panel">
          <div class="autoscan-header">
            <div class="autoscan-title">
              <span class="autoscan-icon">üîÑ</span>
              <span>Auto-Scan</span>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="autoscan-toggle">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="autoscan-config hidden" id="autoscan-config">
            <div class="config-row">
              <label>Alert Email</label>
              <input type="email" id="autoscan-email" placeholder="your@email.com" class="config-input">
            </div>
            <div class="config-row">
              <label>Watchlist</label>
              <select id="autoscan-preset" class="config-select">
                <option value="majors-gold" selected>Majors + Gold (8)</option>
                <option value="majors">Major Pairs (7)</option>
                <option value="crypto">Crypto 24/7 (8)</option>
                <option value="metals">Metals (2)</option>
                <option value="indices">Indices (6)</option>
                <option value="commodities">Commodities (2)</option>
                <option value="minors">Minor Pairs (21)</option>
                <option value="all">All 46 Instruments</option>
              </select>
            </div>
            <div class="config-row">
              <label>Min Grade</label>
              <select id="autoscan-grade" class="config-select">
                <option value="A+">A+ Only</option>
                <option value="A">A or better</option>
                <option value="B+" selected>B+ or better</option>
                <option value="B">B or better</option>
              </select>
            </div>
            <div class="config-row">
              <label>Interval</label>
              <select id="autoscan-interval" class="config-select">
                <option value="180000">3 minutes</option>
                <option value="300000" selected>5 minutes</option>
                <option value="600000">10 minutes</option>
                <option value="900000">15 minutes</option>
                <option value="1800000">30 minutes</option>
              </select>
            </div>
            <div class="config-row">
              <label class="checkbox-label">
                <input type="checkbox" id="autoscan-market-hours" checked>
                <span>Skip closed markets</span>
              </label>
            </div>
            <div class="autoscan-status" id="autoscan-status">
              <div class="status-row">
                <div class="status-item">
                  <span class="status-label">Status:</span>
                  <span class="status-value" id="autoscan-running">Stopped</span>
                </div>
                <div class="status-item market-status">
                  <span class="market-indicator forex" id="market-forex" title="Forex Market">FX</span>
                  <span class="market-indicator crypto active" id="market-crypto" title="Crypto 24/7">Crypto</span>
                </div>
              </div>
              <div class="status-item">
                <span class="status-label">Last Scan:</span>
                <span class="status-value" id="autoscan-last">Never</span>
              </div>
              <div class="status-item">
                <span class="status-label">Next Scan:</span>
                <span class="status-value" id="autoscan-next">-</span>
              </div>
              <div class="status-item">
                <span class="status-label">Scanned:</span>
                <span class="status-value" id="autoscan-scanned">0 symbols</span>
              </div>
              <div class="status-item">
                <span class="status-label">New Signals:</span>
                <span class="status-value" id="autoscan-signals">0</span>
              </div>
              <div class="scan-progress hidden" id="scan-progress">
                <div class="progress-bar">
                  <div class="progress-fill" id="scan-progress-fill"></div>
                </div>
                <span class="progress-text" id="scan-progress-text"></span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Detections Screen (Auto-Scan Detected Trades Cache) -->
      <section id="detections-screen" class="screen hidden">
        <div class="screen-header">
          <h2>üîç Detected Trades</h2>
          <button class="btn btn-small" id="refresh-detections-btn">‚Üª Refresh</button>
        </div>

        <div class="detections-summary" id="detections-summary">
          <div class="stat-card cooling">
            <span class="stat-value" id="stat-cooling">0</span>
            <span class="stat-label">Cooling Down</span>
          </div>
          <div class="stat-card eligible">
            <span class="stat-value" id="stat-eligible">0</span>
            <span class="stat-label">Eligible</span>
          </div>
          <div class="stat-card total">
            <span class="stat-value" id="stat-total-detections">0</span>
            <span class="stat-label">Total Active</span>
          </div>
        </div>

        <div class="detections-filters">
          <button class="filter-btn active" data-detection-filter="all">All</button>
          <button class="filter-btn" data-detection-filter="cooling_down">Cooling Down</button>
          <button class="filter-btn" data-detection-filter="eligible">Eligible</button>
        </div>

        <div class="detections-container" id="detections-container">
          <div class="empty-state">
            <div class="empty-icon">üîç</div>
            <p>No detected trades yet</p>
            <p class="empty-hint">Start auto-scan to detect trading opportunities</p>
            <button class="btn btn-primary" id="go-to-autoscan-btn">Configure Auto-Scan</button>
          </div>
        </div>

        <div class="detections-info">
          <p>‚ÑπÔ∏è Detected trades are held in a 60-minute cooldown before becoming eligible for action. This ensures signal persistence and reduces false positives.</p>
        </div>
      </section>

      <!-- Results Screen -->
      <section id="results-screen" class="screen">
        <div class="screen-header">
          <h2>üìä Scan Results</h2>
          <div class="results-meta">
            <span id="last-scan-time">No scans yet</span>
            <button class="btn btn-small" id="refresh-btn" disabled>‚Üª Refresh</button>
          </div>
        </div>
        
        <div class="results-filters">
          <button class="filter-btn active" data-filter="all">All</button>
          <button class="filter-btn" data-filter="trades">Trades Only</button>
          <button class="filter-btn" data-filter="a+">A+ Only</button>
          <button class="filter-btn" data-filter="no-trade">No Trade</button>
        </div>
        
        <div class="results-with-sidebar">
          <div class="results-container" id="results-container">
            <div class="empty-state">
              <div class="empty-icon">üìã</div>
              <p>No results yet</p>
              <p class="empty-hint">Go to Watchlist and scan some symbols</p>
              <button class="btn btn-primary" id="go-to-watchlist-btn">Open Watchlist</button>
            </div>
          </div>
          
          <div id="market-sidebar-container"></div>
        </div>
        
        <div class="results-footer hidden" id="results-footer">
          <button class="btn btn-secondary" id="export-btn">üíæ Export JSON</button>
          <button class="btn btn-secondary" id="copy-summary-btn">üìã Copy Summary</button>
        </div>
      </section>

      <!-- Loading Overlay -->
      <div id="loading-overlay" class="loading-overlay hidden">
        <div class="loading-content">
          <div class="spinner"></div>
          <p class="loading-text" id="loading-text">Scanning...</p>
          <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
          </div>
          <p class="progress-text" id="progress-text">0/0 complete</p>
        </div>
      </div>
    </main>

    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container" role="status" aria-live="polite" aria-label="Notifications"></div>

    <!-- Trade Modal -->
    <div id="trade-modal" class="modal hidden">
      <div class="modal-backdrop" onclick="App.closeTradeModal()"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="trade-modal-title">Log Trade</h3>
          <button class="modal-close" onclick="App.closeTradeModal()">&times;</button>
        </div>
        <div class="modal-body">
          <form id="trade-form">
            <input type="hidden" id="trade-symbol">
            <input type="hidden" id="trade-action">
            <input type="hidden" id="trade-signal-id">
            
            <div class="form-row">
              <div class="form-group">
                <label for="trade-entry-price">Entry Price</label>
                <input type="number" id="trade-entry-price" step="any" required>
              </div>
              <div class="form-group">
                <label for="trade-lots">Lots</label>
                <input type="number" id="trade-lots" step="0.01" min="0.01" required>
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="trade-stop-loss">Stop Loss</label>
                <input type="number" id="trade-stop-loss" step="any" required>
              </div>
              <div class="form-group">
                <label for="trade-take-profit">Take Profit</label>
                <input type="number" id="trade-take-profit" step="any" required>
              </div>
            </div>
            
            <div class="form-group">
              <label>Status</label>
              <div class="radio-group-inline">
                <label class="radio-inline">
                  <input type="radio" name="trade-status" value="pending"> Pending
                </label>
                <label class="radio-inline">
                  <input type="radio" name="trade-status" value="running" checked> Running
                </label>
                <label class="radio-inline">
                  <input type="radio" name="trade-status" value="closed"> Closed
                </label>
              </div>
            </div>
            
            <div id="trade-closed-fields" class="hidden">
              <div class="form-row">
                <div class="form-group">
                  <label for="trade-exit-price">Exit Price</label>
                  <input type="number" id="trade-exit-price" step="any">
                </div>
                <div class="form-group">
                  <label>Result</label>
                  <div class="radio-group-inline">
                    <label class="radio-inline">
                      <input type="radio" name="trade-result" value="win"> Win
                    </label>
                    <label class="radio-inline">
                      <input type="radio" name="trade-result" value="loss"> Loss
                    </label>
                    <label class="radio-inline">
                      <input type="radio" name="trade-result" value="breakeven"> BE
                    </label>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="form-group">
              <label for="trade-notes">Notes (optional)</label>
              <textarea id="trade-notes" rows="2" placeholder="Any observations..."></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" onclick="App.closeTradeModal()">Cancel</button>
          <button class="btn btn-primary" onclick="App.saveTradeEntry()">Save Trade</button>
        </div>
      </div>
    </div>

    <!-- Journal Screen (add to nav later) -->
    <section id="journal-screen" class="screen hidden">
      <div class="screen-header">
        <h2>üìì Trading Journal</h2>
        <button class="btn btn-small btn-primary" onclick="App.openManualTradeModal()">+ Manual Trade</button>
      </div>
      
      <div class="journal-stats" id="journal-stats">
        <div class="stat-card">
          <span class="stat-value" id="stat-taken">0</span>
          <span class="stat-label">Trades Taken</span>
        </div>
        <div class="stat-card">
          <span class="stat-value" id="stat-winrate">0%</span>
          <span class="stat-label">Win Rate</span>
        </div>
        <div class="stat-card">
          <span class="stat-value" id="stat-avgr">0R</span>
          <span class="stat-label">Avg R</span>
        </div>
        <div class="stat-card">
          <span class="stat-value" id="stat-pnl">$0</span>
          <span class="stat-label">Total P&L</span>
        </div>
      </div>
      
      <div class="journal-filters">
        <button class="filter-btn active" data-journal-filter="all">All</button>
        <button class="filter-btn" data-journal-filter="taken">Taken</button>
        <button class="filter-btn" data-journal-filter="pending">Pending</button>
        <button class="filter-btn" data-journal-filter="running">Running</button>
        <button class="filter-btn" data-journal-filter="closed">Closed</button>
      </div>
      
      <div class="journal-container" id="journal-container">
        <div class="empty-state">
          <div class="empty-icon">üìì</div>
          <p>No trades logged yet</p>
          <p class="empty-hint">Log trades from your scan results</p>
        </div>
      </div>
      
      <div class="journal-footer">
        <a href="/api/journal/export" class="btn btn-secondary" download>üì• Export CSV</a>
      </div>
    </section>
  </div>

  <script src="/js/api.js"></script>
  <script src="/js/storage.js"></script>
  <script src="/js/ui.js"></script>
  <script src="/js/app.js"></script>
</body>
</html>
